# Using pm2

* Remember that pm2 always runs as the user that started the command and other users won't be able to interact with the pm2 process of another users.

* Remember the `watch` flag will look for alterations to the project folder and restart the application when it detects a change. Not useful for applications that alter their own contents. Not to worry pm2 will still restart the application upon a crash.

## Install pm2..

`sudo npm install pm2@latest -g`

## Run a nodejs server using pm2..

`pm2 start app.js`

## pm2 useful commands

* `pm2 monit` - neat dashboard that allows you a good overview of your pm2 applications, kinda heavy on the older hardware..

* `pm2 logs <application name>` to see last set of logs generated by the selected application.

## pm2 ecosystem file

While we can start the node application by `pm2 start app.js` We can also setup a ecosystem file that contains pre-defined settings like environment variables.

* Create an ecosystem file by.. `pm2 ecosystem`

* A sample file looks like this: (note: this is not what pm2 creates just an example from myself!)

```
module.exports = {
  /**
   * Application configuration section
   * http://pm2.keymetrics.io/docs/usage/application-declaration/
   */
  apps : [{
    name        : "Application Name",
    script      : "server/server.js",
    env_prod: {
      "NODE_ENV": "prod",
    },
    env_prod_https : {
       "NODE_ENV": "prod-https"
    },
    env_external_dev : {
       "NODE_ENV": "external-dev"
    }
  }]
}
```
  * After each of the "NODE_ENV" we can set any other environment variables we want/need.

* Run the application by `pm2 start ecosystem.config.js --env prod_https`
  * the value to use after the `--env` is always the object name (ie. `env_prod_https`) but by removing the `env_`.

----
###### References

> http://pm2.keymetrics.io/docs/usage/quick-start/
> http://pm2.keymetrics.io/docs/usage/application-declaration/
